<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters | Source code and supporting information for _Predicting abundances from acoustic data: North Eastern Bird Communities</title>
  <meta name="description" content="Section 8 Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters | Source code and supporting information for _Predicting abundances from acoustic data: North Eastern Bird Communities" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters | Source code and supporting information for _Predicting abundances from acoustic data: North Eastern Bird Communities" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="vjjan91/newHampshire-pointCount-acoustics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters | Source code and supporting information for _Predicting abundances from acoustic data: North Eastern Bird Communities" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pooja Panwar" />
<meta name="author" content="Orlando Acevedo-Charry" />
<meta name="author" content="Sharon Martinson" />
<meta name="author" content="Laurel Symes" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-model-approach.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-comparability.html"><a href="data-comparability.html"><i class="fa fa-check"></i><b>2</b> Data comparability</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-comparability.html"><a href="data-comparability.html#load-necessary-libraries"><i class="fa fa-check"></i><b>2.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="2.2" data-path="data-comparability.html"><a href="data-comparability.html#loading-point-count-and-acoustic-data"><i class="fa fa-check"></i><b>2.2</b> Loading point count and acoustic data</a></li>
<li class="chapter" data-level="2.3" data-path="data-comparability.html"><a href="data-comparability.html#cleaning-up-point-count-data"><i class="fa fa-check"></i><b>2.3</b> Cleaning up point count data</a></li>
<li class="chapter" data-level="2.4" data-path="data-comparability.html"><a href="data-comparability.html#cleaning-up-acoustic-data"><i class="fa fa-check"></i><b>2.4</b> Cleaning up acoustic data</a></li>
<li class="chapter" data-level="2.5" data-path="data-comparability.html"><a href="data-comparability.html#creating-a-combined-dataset"><i class="fa fa-check"></i><b>2.5</b> Creating a combined dataset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html"><i class="fa fa-check"></i><b>3</b> Subsetting data and running exploratory data analyses</a>
<ul>
<li class="chapter" data-level="3.1" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#load-necessary-libraries-1"><i class="fa fa-check"></i><b>3.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="3.2" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#load-dataframe-containing-point-count-and-acoustic-data"><i class="fa fa-check"></i><b>3.2</b> Load dataframe containing point count and acoustic data</a></li>
<li class="chapter" data-level="3.3" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#estimate-total-abundance-and-richness-for-point-count-and-acoustic-data"><i class="fa fa-check"></i><b>3.3</b> Estimate total abundance and richness for point count and acoustic data</a></li>
<li class="chapter" data-level="3.4" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#creating-a-single-dataframe-prior-to-running-statistical-analysis"><i class="fa fa-check"></i><b>3.4</b> Creating a single dataframe prior to running statistical analysis</a></li>
<li class="chapter" data-level="3.5" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#filtering-criteria-for-species-inclusion"><i class="fa fa-check"></i><b>3.5</b> Filtering criteria for species inclusion</a></li>
<li class="chapter" data-level="3.6" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#explore-whether-time-of-day-shows-any-variation-in-abundancedetections"><i class="fa fa-check"></i><b>3.6</b> Explore whether time of day shows any variation in abundance/detections?</a></li>
<li class="chapter" data-level="3.7" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#examining-abundance-and-acoustic-detections-as-a-function-of-time-of-day-by-species"><i class="fa fa-check"></i><b>3.7</b> Examining abundance and acoustic detections as a function of time of day by species</a></li>
<li class="chapter" data-level="3.8" data-path="subsetting-data-and-running-exploratory-data-analyses.html"><a href="subsetting-data-and-running-exploratory-data-analyses.html#save-the-subsetted-data-to-file"><i class="fa fa-check"></i><b>3.8</b> Save the subsetted data to file</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html"><i class="fa fa-check"></i><b>4</b> Creating study area map</a>
<ul>
<li class="chapter" data-level="4.1" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#load-necessary-libraries-2"><i class="fa fa-check"></i><b>4.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="4.2" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#load-associated-shapefiles-for-each-region-sampled"><i class="fa fa-check"></i><b>4.2</b> Load associated shapefiles for each region sampled</a></li>
<li class="chapter" data-level="4.3" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#download-natural-earth-layers"><i class="fa fa-check"></i><b>4.3</b> Download natural earth layers</a></li>
<li class="chapter" data-level="4.4" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#acadia-national-park"><i class="fa fa-check"></i><b>4.4</b> Acadia National Park</a></li>
<li class="chapter" data-level="4.5" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#hubbard-brook"><i class="fa fa-check"></i><b>4.5</b> Hubbard Brook</a></li>
<li class="chapter" data-level="4.6" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#katahdin-woods-and-waters"><i class="fa fa-check"></i><b>4.6</b> Katahdin Woods and Waters</a></li>
<li class="chapter" data-level="4.7" data-path="creating-study-area-map.html"><a href="creating-study-area-map.html#marsh-billings"><i class="fa fa-check"></i><b>4.7</b> Marsh Billings</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html"><i class="fa fa-check"></i><b>5</b> Abundance vs. acoustic detections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#load-necessary-libraries-3"><i class="fa fa-check"></i><b>5.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="5.2" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#load-dataframe-containing-data-that-is-already-filtered-for-a-subset-of-species"><i class="fa fa-check"></i><b>5.2</b> Load dataframe containing data that is already filtered for a subset of species</a></li>
<li class="chapter" data-level="5.3" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#correlations-between-abundance-and-detections"><i class="fa fa-check"></i><b>5.3</b> Correlations between abundance and detections</a></li>
<li class="chapter" data-level="5.4" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#scaling-of-predictors-and-determining-distribution-family"><i class="fa fa-check"></i><b>5.4</b> Scaling of predictors and determining distribution family</a></li>
<li class="chapter" data-level="5.5" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#generalized-linear-mixed-model-between-abundance-and-acoustic-detections"><i class="fa fa-check"></i><b>5.5</b> Generalized linear mixed model between abundance and acoustic detections</a></li>
<li class="chapter" data-level="5.6" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#model-diagnostics"><i class="fa fa-check"></i><b>5.6</b> Model diagnostics</a></li>
<li class="chapter" data-level="5.7" data-path="abundance-vs.-acoustic-detections.html"><a href="abundance-vs.-acoustic-detections.html#predict-abundance-given-detections"><i class="fa fa-check"></i><b>5.7</b> Predict abundance given detections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="calling-rates.html"><a href="calling-rates.html"><i class="fa fa-check"></i><b>6</b> Calling rates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="calling-rates.html"><a href="calling-rates.html#load-necessary-libraries-4"><i class="fa fa-check"></i><b>6.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="6.2" data-path="calling-rates.html"><a href="calling-rates.html#load-previous-model-object-and-filtered-data"><i class="fa fa-check"></i><b>6.2</b> Load previous model object and filtered data</a></li>
<li class="chapter" data-level="6.3" data-path="calling-rates.html"><a href="calling-rates.html#calculating-calling-rate"><i class="fa fa-check"></i><b>6.3</b> Calculating calling rate</a></li>
<li class="chapter" data-level="6.4" data-path="calling-rates.html"><a href="calling-rates.html#does-calling-rate-vary-as-a-function-of-number-of-individuals"><i class="fa fa-check"></i><b>6.4</b> Does calling rate vary as a function of number of individuals</a></li>
<li class="chapter" data-level="6.5" data-path="calling-rates.html"><a href="calling-rates.html#is-calling-rate-linked-to-the-fit-between-predicted-abundance-and-acoustic-detections"><i class="fa fa-check"></i><b>6.5</b> Is calling rate linked to the fit between predicted abundance and acoustic detections?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html"><i class="fa fa-check"></i><b>7</b> Hierarchical model approach</a>
<ul>
<li class="chapter" data-level="7.1" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#packages"><i class="fa fa-check"></i><b>7.1</b> Packages</a></li>
<li class="chapter" data-level="7.2" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#loading-and-exploring-data"><i class="fa fa-check"></i><b>7.2</b> Loading and exploring data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#figures-of-the-data"><i class="fa fa-check"></i><b>7.2.1</b> Figures of the data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#hierarchical-model-for-counts-with-two-observation-processes"><i class="fa fa-check"></i><b>7.3</b> Hierarchical model for counts with two observation processes</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#state-process-for-morning-expected-counts"><i class="fa fa-check"></i><b>7.3.1</b> State process for morning expected counts</a></li>
<li class="chapter" data-level="7.3.2" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#observation-process-for-morning-point-counts"><i class="fa fa-check"></i><b>7.3.2</b> Observation process for morning point counts</a></li>
<li class="chapter" data-level="7.3.3" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#observation-process-for-morning-acoustic-detections"><i class="fa fa-check"></i><b>7.3.3</b> Observation process for morning acoustic detections</a></li>
<li class="chapter" data-level="7.3.4" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#coding-observation-point-counts"><i class="fa fa-check"></i><b>7.3.4</b> Coding Observation point counts</a></li>
<li class="chapter" data-level="7.3.5" data-path="hierarchical-model-approach.html"><a href="hierarchical-model-approach.html#coding-acoustic-detections-counts"><i class="fa fa-check"></i><b>7.3.5</b> Coding Acoustic detections counts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><i class="fa fa-check"></i><b>8</b> Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters</a>
<ul>
<li class="chapter" data-level="8.1" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#packages-1"><i class="fa fa-check"></i><b>8.1</b> Packages</a></li>
<li class="chapter" data-level="8.2" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#loading-and-exploring-data-1"><i class="fa fa-check"></i><b>8.2</b> Loading and exploring data</a></li>
<li class="chapter" data-level="8.3" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#hierarchical-model-for-counts-with-two-observation-processes-1"><i class="fa fa-check"></i><b>8.3</b> Hierarchical model for counts with two observation processes</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#coding-observation-point-counts-1"><i class="fa fa-check"></i><b>8.3.1</b> Coding Observation point counts</a></li>
<li class="chapter" data-level="8.3.2" data-path="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#coding-acoustic-detections-counts-1"><i class="fa fa-check"></i><b>8.3.2</b> Coding Acoustic detections counts</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code and supporting information for _Predicting abundances from acoustic data: North Eastern Bird Communities</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Section 8</span> Another example with hierarchical model approach - OVEN in Katahdin Woods and Waters<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="packages-1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Packages<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#packages-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb65-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb65-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb65-2" tabindex="-1"></a><span class="fu">library</span>(MetBrewer)</span>
<span id="cb65-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb65-3" tabindex="-1"></a><span class="fu">library</span>(dclone)</span>
<span id="cb65-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb65-4" tabindex="-1"></a><span class="fu">library</span>(mcmcplots)</span></code></pre></div>
</div>
<div id="loading-and-exploring-data-1" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Loading and exploring data<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#loading-and-exploring-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s load the file used in <code>01_data-comparability.Rmd</code> script.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb66-1" tabindex="-1"></a>acous_count <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;results/pooled_pointCount_acoustic_data.csv&quot;</span>)</span></code></pre></div>
<p>Let’s work on the species-site combination of more data: Ovenbird in Marsh-Billings-Rockefeller NHP.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-1" tabindex="-1"></a>acous_count_filt <span class="ot">&lt;-</span> acous_count <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-2" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb67-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-3" tabindex="-1"></a>    <span class="co">#&quot;American Crow&quot;,&quot;American Robin&quot;,&quot;Black-and-white Warbler&quot;,&quot;Black-capped Chickadee&quot;,&quot;Black-throated Blue Warbler&quot;,&quot;Black-throated Green Warbler&quot;,&quot;Blackburnian Warbler&quot;,&quot;Blue Jay&quot;,&quot;Blue-headed Vireo&quot;,&quot;Brown Creeper&quot;,&quot;Eastern Wood-Pewee&quot;,&quot;Golden-crowned Kinglet&quot;,&quot;Hermit Thrush&quot;,&quot;Northern Parula&quot;,</span></span>
<span id="cb67-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-4" tabindex="-1"></a>    </span>
<span id="cb67-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-5" tabindex="-1"></a>                            <span class="st">&quot;Ovenbird&quot;</span> </span>
<span id="cb67-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-6" tabindex="-1"></a>                            </span>
<span id="cb67-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-7" tabindex="-1"></a>                            <span class="co">#,&quot;Pine Warbler&quot;,&quot;Red-breasted Nuthatch&quot;,&quot;Red-eyed Vireo&quot;,&quot;Scarlet Tanager&quot;,&quot;Winter Wren&quot;,&quot;Yellow-bellied Sapsucker&quot;,&quot;Yellow-rumped Warbler&quot;</span></span>
<span id="cb67-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-8" tabindex="-1"></a>                            ),</span>
<span id="cb67-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-9" tabindex="-1"></a>    site_name <span class="sc">==</span> <span class="st">&quot;Katahdin Woods and Waters&quot;</span>)</span>
<span id="cb67-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb67-10" tabindex="-1"></a><span class="fu">table</span>(acous_count_filt<span class="sc">$</span>common_name, acous_count_filt<span class="sc">$</span>data_type)</span></code></pre></div>
<p>How to reconcile time of detection of each record?</p>
<p>While the <code>point_count</code> data include the <code>observation_time</code> variable, this information for the <code>acoustic_data</code> seems to be at the <code>begin_clock_time</code> variable. Let’s adjust this with the function <code>coalesce</code> from <code>dplyr</code> in <code>tidyverse</code>. Then, we can consolidate the “initial temporal window” per visit in each site_id with the detection time.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-1" tabindex="-1"></a>acoust_count_summary <span class="ot">&lt;-</span> acous_count_filt <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-2" tabindex="-1"></a>  <span class="co"># dummy column to unify time of detection either by count or </span></span>
<span id="cb68-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">detection_time =</span> <span class="fu">coalesce</span>(observation_time, begin_clock_time)) <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-4" tabindex="-1"></a>  <span class="co"># initial temporal window</span></span>
<span id="cb68-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-5" tabindex="-1"></a>  <span class="fu">group_by</span>(site_id, date, visit_number) <span class="sc">|&gt;</span></span>
<span id="cb68-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_window =</span> <span class="fu">min</span>(hms<span class="sc">::</span><span class="fu">as_hms</span>(detection_time), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-7" tabindex="-1"></a>         <span class="at">time_window =</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(time_window)) <span class="sc">|&gt;</span></span>
<span id="cb68-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-8" tabindex="-1"></a>  <span class="co"># First summarization to extract sum of counts per point count and number of detections</span></span>
<span id="cb68-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-9" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, site_id, date, visit_number, common_name, data_type, time_window, detection_time) <span class="sc">|&gt;</span></span>
<span id="cb68-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-10" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">abundance =</span> <span class="fu">sum</span>(abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-11" tabindex="-1"></a>         <span class="at">acous_detections =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb68-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-12" tabindex="-1"></a>  <span class="co"># Second summarization to count number of detections and extract overall counts</span></span>
<span id="cb68-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-13" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name, site_id, date, visit_number, common_name, time_window) <span class="sc">|&gt;</span></span>
<span id="cb68-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-14" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">counts =</span> <span class="fu">sum</span>(abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-15" tabindex="-1"></a>         <span class="at">acous_detections =</span> <span class="fu">sum</span>(acous_detections)) <span class="sc">|&gt;</span></span>
<span id="cb68-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-16" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb68-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-17" tabindex="-1"></a></span>
<span id="cb68-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-18" tabindex="-1"></a>acoust_count_summary<span class="sc">$</span>DateTime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(acoust_count_summary<span class="sc">$</span>date, acoust_count_summary<span class="sc">$</span>time_window), <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span>
<span id="cb68-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-19" tabindex="-1"></a></span>
<span id="cb68-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-20" tabindex="-1"></a>acoust_count_summary<span class="sc">$</span>Time_window <span class="ot">&lt;-</span> <span class="fu">floor_date</span>(acoust_count_summary<span class="sc">$</span>DateTime, <span class="st">&quot;10 mins&quot;</span>)</span>
<span id="cb68-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-21" tabindex="-1"></a></span>
<span id="cb68-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb68-22" tabindex="-1"></a><span class="fu">str</span>(acoust_count_summary)</span></code></pre></div>
<p>And we can generate the figures. This are similar to my previous attempt, but including some days or point counts discarded by Vijay due to species richness.</p>
</div>
<div id="hierarchical-model-for-counts-with-two-observation-processes-1" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Hierarchical model for counts with two observation processes<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#hierarchical-model-for-counts-with-two-observation-processes-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="coding-observation-point-counts-1" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Coding Observation point counts<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#coding-observation-point-counts-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Preparing data for data cloning</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-1" tabindex="-1"></a></span>
<span id="cb69-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-2" tabindex="-1"></a>acoust_count_df <span class="ot">&lt;-</span> acoust_count_summary <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Time_w_alone =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(Time_window, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>), <span class="st">&quot;%H:%M&quot;</span>), </span>
<span id="cb69-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-4" tabindex="-1"></a>         <span class="at">counts =</span> counts<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb69-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-5" tabindex="-1"></a>         <span class="at">acous_detections =</span> acous_detections<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb69-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-6" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date), </span>
<span id="cb69-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-7" tabindex="-1"></a>         ) <span class="sc">|&gt;</span></span>
<span id="cb69-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-8" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-9" tabindex="-1"></a>  <span class="fu">arrange</span>(Time_window)</span>
<span id="cb69-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-10" tabindex="-1"></a></span>
<span id="cb69-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-11" tabindex="-1"></a><span class="co"># generate sequence of potential point counts</span></span>
<span id="cb69-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-12" tabindex="-1"></a>seq_df <span class="ot">&lt;-</span> acoust_count_df <span class="sc">|&gt;</span></span>
<span id="cb69-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-13" tabindex="-1"></a>  <span class="fu">distinct</span>(date) <span class="sc">|&gt;</span>   <span class="co"># keep only unique sampled dates</span></span>
<span id="cb69-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">seq =</span> <span class="fu">map</span>(date, <span class="sc">~</span> <span class="fu">seq</span>(</span>
<span id="cb69-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-15" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(.x, <span class="st">&quot;05:00:00&quot;</span>)),</span>
<span id="cb69-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-16" tabindex="-1"></a>    <span class="at">to   =</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(.x, <span class="st">&quot;10:00:00&quot;</span>)),</span>
<span id="cb69-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-17" tabindex="-1"></a>    <span class="at">by   =</span> <span class="st">&quot;10 min&quot;</span></span>
<span id="cb69-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-18" tabindex="-1"></a>  ))) <span class="sc">|&gt;</span></span>
<span id="cb69-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-19" tabindex="-1"></a>  <span class="fu">unnest</span>(seq) <span class="sc">|&gt;</span></span>
<span id="cb69-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Time_window =</span> seq,</span>
<span id="cb69-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-21" tabindex="-1"></a>         <span class="at">Time_w_alone =</span> <span class="fu">format</span>(seq, <span class="st">&quot;%H:%M&quot;</span>))</span>
<span id="cb69-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-22" tabindex="-1"></a></span>
<span id="cb69-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-23" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> seq_df <span class="sc">|&gt;</span></span>
<span id="cb69-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-24" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(date, Time_w_alone)) <span class="sc">|&gt;</span></span>
<span id="cb69-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-25" tabindex="-1"></a>  <span class="fu">left_join</span>(acoust_count_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;Time_w_alone&quot;</span>)) </span>
<span id="cb69-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-26" tabindex="-1"></a></span>
<span id="cb69-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-27" tabindex="-1"></a>final_df<span class="sc">$</span>DateTime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(final_df<span class="sc">$</span>date, final_df<span class="sc">$</span>Time_w_alone), <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d %H:%M&quot;</span>)</span>
<span id="cb69-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-28" tabindex="-1"></a></span>
<span id="cb69-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb69-29" tabindex="-1"></a>final_df<span class="sc">$</span>time_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(final_df<span class="sc">$</span>DateTime))</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-1" tabindex="-1"></a>StochGSS.dc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb70-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-2" tabindex="-1"></a>  </span>
<span id="cb70-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-3" tabindex="-1"></a>  <span class="co"># Priors on model parameters. Priors are DC1 in Lele et al (2007)</span></span>
<span id="cb70-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-4" tabindex="-1"></a>  a1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>);        <span class="co"># constant, equivalent to the population growth rate. </span></span>
<span id="cb70-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-5" tabindex="-1"></a>  c1 <span class="sc">~</span> <span class="fu">dunif</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>);       <span class="co"># constant, the density dependence parameter. </span></span>
<span id="cb70-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-6" tabindex="-1"></a>  sig1 <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="dv">10</span>); <span class="co">#variance parameter of stochastic  environment (process noise) in the system</span></span>
<span id="cb70-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-7" tabindex="-1"></a>  stovar1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">pow</span>(sig1,<span class="dv">2</span>)</span>
<span id="cb70-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-8" tabindex="-1"></a>  tau1 <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">1</span>); <span class="co"># detection probability in Binomial distribution</span></span>
<span id="cb70-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-9" tabindex="-1"></a>  </span>
<span id="cb70-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-10" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb70-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-11" tabindex="-1"></a>    <span class="co"># Simulate trajectory that depends on the previous</span></span>
<span id="cb70-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-12" tabindex="-1"></a>    mean_X1[<span class="dv">1</span>,k] <span class="ot">&lt;-</span> a1<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>c1) <span class="co"># Expected value of the first realization of the process</span></span>
<span id="cb70-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-13" tabindex="-1"></a>    <span class="co"># this is drawn from the stationary distribution of the process</span></span>
<span id="cb70-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-14" tabindex="-1"></a>    <span class="co"># Equation 14 (main text) and  A.4 in Appendix of Dennis et al 2006</span></span>
<span id="cb70-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-15" tabindex="-1"></a>    Varno1[k] <span class="ot">&lt;-</span> <span class="fu">pow</span>(sig1,<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pow</span>(c1,<span class="dv">2</span>)) <span class="co">#. Equation A.5 in Appendix of Dennis et al 2006</span></span>
<span id="cb70-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-16" tabindex="-1"></a>    </span>
<span id="cb70-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-17" tabindex="-1"></a>    <span class="co"># Updating the state: Stochastic process for all time steps</span></span>
<span id="cb70-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-18" tabindex="-1"></a>    X1[<span class="dv">1</span>,k]<span class="sc">~</span><span class="fu">dnorm</span>(mean_X1[<span class="dv">1</span>,k], <span class="dv">1</span><span class="sc">/</span>Varno1[k]); <span class="co">#first estimation of population</span></span>
<span id="cb70-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-19" tabindex="-1"></a>    </span>
<span id="cb70-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-20" tabindex="-1"></a>    <span class="co">#iteration of the GSS model in the data</span></span>
<span id="cb70-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-21" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>qp1) {</span>
<span id="cb70-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-22" tabindex="-1"></a>      mean_X1[t,k] <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1 <span class="sc">*</span> X1[(t <span class="sc">-</span> <span class="dv">1</span>),k]</span>
<span id="cb70-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-23" tabindex="-1"></a>      X1[t,k] <span class="sc">~</span> <span class="fu">dnorm</span>(mean_X1[t,k], stovar1) <span class="co"># Et is included here since a+cX(t-1) + Et ~ Normal(a+cX(t-1),sigma^2)</span></span>
<span id="cb70-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-24" tabindex="-1"></a>    }</span>
<span id="cb70-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-25" tabindex="-1"></a>    </span>
<span id="cb70-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-26" tabindex="-1"></a>    <span class="co"># Updating the observations, from the counts under Binomial observation error</span></span>
<span id="cb70-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-27" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>qp1) {</span>
<span id="cb70-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-28" tabindex="-1"></a>      N1[t,k] <span class="sc">~</span> <span class="fu">dpois</span>(<span class="fu">exp</span>(X1[t,k]))   <span class="co"># trick to convert continuous exp(X1) to integer counts as trials</span></span>
<span id="cb70-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-29" tabindex="-1"></a>      Y1[t,k] <span class="sc">~</span> <span class="fu">dbin</span>(tau1, N1[t,k])   <span class="co"># </span></span>
<span id="cb70-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-30" tabindex="-1"></a>    }</span>
<span id="cb70-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-31" tabindex="-1"></a>  }</span>
<span id="cb70-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb70-32" tabindex="-1"></a>}</span></code></pre></div>
<p>For this model, we will need some initial values of the parameters, and given that there could be many <code>NA</code> a wrap to provide those initial guess values.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-1" tabindex="-1"></a>guess.calc <span class="ot">&lt;-</span> <span class="cf">function</span>(Yobs,Tvec){</span>
<span id="cb71-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-2" tabindex="-1"></a>  </span>
<span id="cb71-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-3" tabindex="-1"></a>  T.t <span class="ot">&lt;-</span>Tvec<span class="sc">-</span>Tvec[<span class="dv">1</span>]; <span class="co">#  For calculations, time starts at zero.</span></span>
<span id="cb71-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-4" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">length</span>(Yobs)<span class="sc">-</span><span class="dv">1</span>;      <span class="co">#  Number of time series transitions, q.</span></span>
<span id="cb71-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-5" tabindex="-1"></a>  qp1 <span class="ot">&lt;-</span> q<span class="sc">+</span><span class="dv">1</span>;              <span class="co">#  q+1 gets used a lot, too.</span></span>
<span id="cb71-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-6" tabindex="-1"></a>  S.t <span class="ot">&lt;-</span> T.t[<span class="dv">2</span><span class="sc">:</span>qp1]<span class="sc">-</span>T.t[<span class="dv">1</span><span class="sc">:</span>q];  <span class="co">#  Time intervals.</span></span>
<span id="cb71-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-7" tabindex="-1"></a>  Ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(Yobs);</span>
<span id="cb71-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-8" tabindex="-1"></a>  Yvar <span class="ot">&lt;-</span> <span class="fu">sum</span>((Yobs<span class="sc">-</span>Ybar)<span class="sc">*</span>(Yobs<span class="sc">-</span>Ybar))<span class="sc">/</span>q;</span>
<span id="cb71-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-9" tabindex="-1"></a>  mu1 <span class="ot">&lt;-</span> Ybar;</span>
<span id="cb71-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-10" tabindex="-1"></a>  </span>
<span id="cb71-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-11" tabindex="-1"></a>  <span class="co"># Kludge an initial value for theta based on mean of Y(t+s) given Y(t).</span></span>
<span id="cb71-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-12" tabindex="-1"></a>  th1<span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">mean</span>(<span class="fu">log</span>(<span class="fu">abs</span>((Yobs[<span class="dv">2</span><span class="sc">:</span>qp1]<span class="sc">-</span>mu1)<span class="sc">/</span>(Yobs[<span class="dv">1</span><span class="sc">:</span>q]<span class="sc">-</span>mu1)))<span class="sc">/</span>S.t);            </span>
<span id="cb71-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-13" tabindex="-1"></a>  bsq1<span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>th1<span class="sc">*</span>Yvar<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>th1);         <span class="co"># Moment estimate using stationary</span></span>
<span id="cb71-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-14" tabindex="-1"></a>  tsq1<span class="ot">&lt;-</span> bsq1;                         <span class="co">#   variance, with betasq=tausq.</span></span>
<span id="cb71-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-15" tabindex="-1"></a>  </span>
<span id="cb71-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-16" tabindex="-1"></a>  <span class="co">#three 0&#39;s </span></span>
<span id="cb71-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-17" tabindex="-1"></a>  three0s <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">c</span>(th1,bsq1,tsq1))</span>
<span id="cb71-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-18" tabindex="-1"></a>  <span class="cf">if</span>(three0s<span class="sc">==</span><span class="dv">0</span><span class="sc">|</span><span class="fu">is.na</span>(three0s)){th1 <span class="ot">&lt;-</span> <span class="fl">0.5</span>;bsq1 <span class="ot">&lt;-</span> <span class="fl">0.09</span>; tsq1 <span class="ot">&lt;-</span> <span class="fl">0.23</span>;}</span>
<span id="cb71-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-19" tabindex="-1"></a>  </span>
<span id="cb71-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-20" tabindex="-1"></a>  </span>
<span id="cb71-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-21" tabindex="-1"></a>  out1 <span class="ot">&lt;-</span> <span class="fu">c</span>(th1,bsq1,tsq1);</span>
<span id="cb71-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-22" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(out1<span class="sc">&lt;</span><span class="fl">1e-7</span>)<span class="sc">&gt;=</span><span class="dv">1</span>){out1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.09</span>,<span class="fl">0.23</span>)}</span>
<span id="cb71-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-23" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(mu1,out1);</span>
<span id="cb71-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-24" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">abs</span>(out))</span>
<span id="cb71-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-25" tabindex="-1"></a>  </span>
<span id="cb71-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-26" tabindex="-1"></a>}</span>
<span id="cb71-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-27" tabindex="-1"></a></span>
<span id="cb71-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-28" tabindex="-1"></a>guess.calc2<span class="fl">.0</span><span class="ot">&lt;-</span> <span class="cf">function</span>(TimeAndNs){</span>
<span id="cb71-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-29" tabindex="-1"></a>  </span>
<span id="cb71-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-30" tabindex="-1"></a>  newmat <span class="ot">&lt;-</span> TimeAndNs </span>
<span id="cb71-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-31" tabindex="-1"></a>  isnas <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(TimeAndNs))</span>
<span id="cb71-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-32" tabindex="-1"></a>  </span>
<span id="cb71-33"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-33" tabindex="-1"></a>  <span class="cf">if</span>(isnas <span class="sc">&gt;=</span> <span class="dv">1</span>){</span>
<span id="cb71-34"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-34" tabindex="-1"></a>    </span>
<span id="cb71-35"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-35" tabindex="-1"></a>    isnaind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(TimeAndNs[,<span class="dv">2</span>]), <span class="at">arr.ind=</span><span class="cn">TRUE</span>)</span>
<span id="cb71-36"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-36" tabindex="-1"></a>    newmat <span class="ot">&lt;-</span> TimeAndNs[<span class="sc">-</span>isnaind,]</span>
<span id="cb71-37"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-37" tabindex="-1"></a>    newmat[,<span class="dv">1</span>] <span class="ot">&lt;-</span> newmat[,<span class="dv">1</span>] <span class="sc">-</span> newmat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb71-38"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-38" tabindex="-1"></a>    </span>
<span id="cb71-39"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-39" tabindex="-1"></a>  }</span>
<span id="cb71-40"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-40" tabindex="-1"></a>  </span>
<span id="cb71-41"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-41" tabindex="-1"></a>  init.guess <span class="ot">&lt;-</span> <span class="fu">guess.calc</span>(<span class="at">Yobs =</span> <span class="fu">log</span>(newmat[,<span class="dv">2</span>]), <span class="at">Tvec=</span>newmat[,<span class="dv">1</span>])</span>
<span id="cb71-42"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-42" tabindex="-1"></a>  </span>
<span id="cb71-43"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-43" tabindex="-1"></a>  mu1  <span class="ot">&lt;-</span> init.guess[<span class="dv">1</span>]</span>
<span id="cb71-44"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-44" tabindex="-1"></a>  th1  <span class="ot">&lt;-</span> init.guess[<span class="dv">2</span>]</span>
<span id="cb71-45"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-45" tabindex="-1"></a>  bsq1 <span class="ot">&lt;-</span> init.guess[<span class="dv">3</span>]</span>
<span id="cb71-46"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-46" tabindex="-1"></a>  sigsq1<span class="ot">&lt;-</span> ((<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>th1))<span class="sc">*</span>bsq1)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>th1)</span>
<span id="cb71-47"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-47" tabindex="-1"></a>  </span>
<span id="cb71-48"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-48" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">mu=</span>mu1, <span class="at">theta=</span>th1, <span class="at">sigmasq =</span> sigsq1)</span>
<span id="cb71-49"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-49" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb71-50"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb71-50" tabindex="-1"></a>}</span></code></pre></div>
<p>And we have to bundle the data for Data cloning. Let’s fit the first species in the taxa with higher data (Ovenbird in Marsh-Billings-Rockefeller NHP) as a test.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-1" tabindex="-1"></a>ts<span class="fl">.4</span>guess  <span class="ot">&lt;-</span>  final_df<span class="sc">$</span>counts</span>
<span id="cb72-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-2" tabindex="-1"></a>tvec4guess  <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ts<span class="fl">.4</span>guess)</span>
<span id="cb72-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-3" tabindex="-1"></a>onets4guess <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tvec4guess, ts<span class="fl">.4</span>guess)</span>
<span id="cb72-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-4" tabindex="-1"></a>naive.guess <span class="ot">&lt;-</span> <span class="fu">guess.calc2.0</span>(<span class="at">TimeAndNs =</span> onets4guess)</span>
<span id="cb72-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-5" tabindex="-1"></a></span>
<span id="cb72-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-6" tabindex="-1"></a>datalistGSS.dc <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">K =</span> <span class="dv">1</span>,</span>
<span id="cb72-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-7" tabindex="-1"></a>                       <span class="at">qp1 =</span> <span class="fu">length</span>(ts<span class="fl">.4</span>guess),</span>
<span id="cb72-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-8" tabindex="-1"></a>                       <span class="at">Y1 =</span> <span class="fu">dcdim</span>(<span class="fu">array</span>(ts<span class="fl">.4</span>guess,</span>
<span id="cb72-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-9" tabindex="-1"></a>                                        <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(ts<span class="fl">.4</span>guess),<span class="dv">1</span>)))) </span>
<span id="cb72-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-10" tabindex="-1"></a></span>
<span id="cb72-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-11" tabindex="-1"></a>dcrun.GSS <span class="ot">&lt;-</span> <span class="fu">dc.fit</span>(<span class="at">data =</span> datalistGSS.dc,</span>
<span id="cb72-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-12" tabindex="-1"></a>                    <span class="at">params =</span> <span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;c1&quot;</span>, <span class="st">&quot;sig1&quot;</span>, <span class="st">&quot;tau1&quot;</span>), </span>
<span id="cb72-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-13" tabindex="-1"></a>                    <span class="at">model =</span> StochGSS.dc, </span>
<span id="cb72-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-14" tabindex="-1"></a>                    <span class="at">n.clones =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb72-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-15" tabindex="-1"></a>                    <span class="at">multiply =</span> <span class="st">&quot;K&quot;</span>,</span>
<span id="cb72-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-16" tabindex="-1"></a>                    <span class="at">unchanged =</span> <span class="st">&quot;qp1&quot;</span>,</span>
<span id="cb72-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-17" tabindex="-1"></a>                    <span class="at">n.chains =</span> <span class="dv">3</span>,</span>
<span id="cb72-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-18" tabindex="-1"></a>                    <span class="at">n.adapt =</span> <span class="dv">5000</span>,</span>
<span id="cb72-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-19" tabindex="-1"></a>                    <span class="at">n.update =</span> <span class="dv">100</span>,</span>
<span id="cb72-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-20" tabindex="-1"></a>                    <span class="at">thin =</span> <span class="dv">20</span>,</span>
<span id="cb72-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-21" tabindex="-1"></a>                    <span class="at">n.iter =</span> <span class="dv">20000</span>)</span>
<span id="cb72-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-22" tabindex="-1"></a></span>
<span id="cb72-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb72-23" tabindex="-1"></a><span class="fu">saveRDS</span>(dcrun.GSS, <span class="st">&quot;data/dcfitGSS_2023_OVEN_KWW.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-1" tabindex="-1"></a>dcrun.GSS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/dcfitGSS_2023_OVEN_KWW.rds&quot;</span>)</span>
<span id="cb73-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-3" tabindex="-1"></a><span class="fu">summary</span>(dcrun.GSS);</span>
<span id="cb73-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-4" tabindex="-1"></a><span class="fu">dcdiag</span>(dcrun.GSS) </span>
<span id="cb73-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dcdiag</span>(dcrun.GSS))</span>
<span id="cb73-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-6" tabindex="-1"></a><span class="fu">pairs</span>(dcrun.GSS)</span>
<span id="cb73-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb73-7" tabindex="-1"></a><span class="fu">coef</span>(dcrun.GSS)</span></code></pre></div>
<div class="float">
<img src="figs/dc_GSS_parameters_OVEN2023KWW.jpeg" alt="Data cloning results for four parameters of GSS from point counts" />
<div class="figcaption">Data cloning results for four parameters of GSS from point counts</div>
</div>
<p>And with these coefficients of the model, we can estimate latent count trajectories with the Kalman filter structure. This Kalman filter structure allows simultaneous estimation of latent states for observed time steps and prediction for missing ones, leveraging the temporal correlation in the process model.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-1" tabindex="-1"></a>Kalman.pred.fn <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb74-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-2" tabindex="-1"></a><span class="co"># Priors on model parameters: they are on the real line.</span></span>
<span id="cb74-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-3" tabindex="-1"></a>  parms <span class="sc">~</span> <span class="fu">dmnorm</span>(MuPost,PrecPost)</span>
<span id="cb74-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-4" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> parms[<span class="dv">1</span>]   </span>
<span id="cb74-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-5" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> parms[<span class="dv">2</span>] </span>
<span id="cb74-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-6" tabindex="-1"></a>  sig1 <span class="ot">&lt;-</span> parms[<span class="dv">3</span>]</span>
<span id="cb74-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-7" tabindex="-1"></a>  stovar1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">pow</span>(sig1,<span class="dv">2</span>)</span>
<span id="cb74-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-8" tabindex="-1"></a>  tau1 <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb74-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-9" tabindex="-1"></a>  </span>
<span id="cb74-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-10" tabindex="-1"></a>  <span class="co"># Likelihood</span></span>
<span id="cb74-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-11" tabindex="-1"></a>  mean_X1[<span class="dv">1</span>] <span class="ot">&lt;-</span> a1<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>c1) <span class="co"># Expected value of the first realization of the process</span></span>
<span id="cb74-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-12" tabindex="-1"></a>    <span class="co"># this is drawn from the stationary distribution of the process</span></span>
<span id="cb74-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-13" tabindex="-1"></a>    <span class="co"># Equation 14 (main text) and  A.4 in Appendix of Dennis et al 2006</span></span>
<span id="cb74-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-14" tabindex="-1"></a>    Varno1 <span class="ot">&lt;-</span> <span class="fu">pow</span>(sig1,<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pow</span>(c1,<span class="dv">2</span>)) <span class="co">#. Equation A.5 in Appendix of Dennis et al 2006</span></span>
<span id="cb74-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-15" tabindex="-1"></a>    </span>
<span id="cb74-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-16" tabindex="-1"></a>    <span class="co"># Updating the state: Stochastic process for all time steps</span></span>
<span id="cb74-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-17" tabindex="-1"></a>    X1[<span class="dv">1</span>]<span class="sc">~</span><span class="fu">dnorm</span>(mean_X1[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span>Varno1); <span class="co">#first estimation of population</span></span>
<span id="cb74-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-18" tabindex="-1"></a>    C[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">exp</span>(X1[<span class="dv">1</span>])</span>
<span id="cb74-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-19" tabindex="-1"></a>    <span class="co">#iteration of the GSS model in the data</span></span>
<span id="cb74-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-20" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>qp1) {</span>
<span id="cb74-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-21" tabindex="-1"></a>      mean_X1[t] <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1 <span class="sc">*</span> X1[(t <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb74-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-22" tabindex="-1"></a>      X1[t] <span class="sc">~</span> <span class="fu">dnorm</span>(mean_X1[t], stovar1) <span class="co"># Et is included here since a+cX(t-1) + Et ~ Normal(a+cX(t-1),sigma^2)</span></span>
<span id="cb74-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-23" tabindex="-1"></a>      N[t] <span class="sc">~</span> <span class="fu">dpois</span>(<span class="fu">exp</span>(X1[t]))   <span class="co"># trick to convert continuous exp(X1) to integer counts as trials in binomial</span></span>
<span id="cb74-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-24" tabindex="-1"></a>      Y1[(t<span class="dv">-1</span>)] <span class="sc">~</span> <span class="fu">dbin</span>(tau1, N[t])   <span class="co"># </span></span>
<span id="cb74-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-25" tabindex="-1"></a>      C[t] <span class="ot">&lt;-</span> <span class="fu">exp</span>(X1[t]) <span class="co"># expected count</span></span>
<span id="cb74-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-26" tabindex="-1"></a>    }</span>
<span id="cb74-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb74-27" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb75-1" tabindex="-1"></a>data4kalman <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">qp1 =</span> <span class="fu">as.numeric</span>(<span class="fu">length</span>(final_df<span class="sc">$</span>counts)),</span>
<span id="cb75-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb75-2" tabindex="-1"></a>                    <span class="at">Y1 =</span> <span class="fu">array</span>(final_df<span class="sc">$</span>counts,</span>
<span id="cb75-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb75-3" tabindex="-1"></a>                               <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">as.numeric</span>(<span class="fu">length</span>(final_df<span class="sc">$</span>counts)))),</span>
<span id="cb75-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb75-4" tabindex="-1"></a>                    <span class="at">MuPost =</span> <span class="fu">coef</span>(dcrun.GSS),</span>
<span id="cb75-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb75-5" tabindex="-1"></a>                    <span class="at">PrecPost =</span> <span class="fu">solve</span>(<span class="fu">vcov</span>(dcrun.GSS))) </span></code></pre></div>
<p>And run the Bayesian inference using the MLE from Data cloning</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb76-1" tabindex="-1"></a>BH_DC_Pred <span class="ot">=</span> <span class="fu">jags.fit</span>(<span class="at">data=</span>data4kalman, </span>
<span id="cb76-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb76-2" tabindex="-1"></a>                      <span class="at">params=</span><span class="fu">c</span>(<span class="st">&quot;C&quot;</span>), </span>
<span id="cb76-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb76-3" tabindex="-1"></a>                      <span class="at">model=</span>Kalman.pred.fn)</span></code></pre></div>
<p>And we can generate a dataframe of the time series with the estimates, inter quartile range, and observed data through time</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-1" tabindex="-1"></a><span class="fu">summary</span>(BH_DC_Pred)</span>
<span id="cb77-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-2" tabindex="-1"></a><span class="co"># extract predictions and CI around them</span></span>
<span id="cb77-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-3" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">mcmcapply</span>(BH_DC_Pred, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))))</span>
<span id="cb77-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-4" tabindex="-1"></a></span>
<span id="cb77-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-5" tabindex="-1"></a>ExpectedCounts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(final_df,pred))</span>
<span id="cb77-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-6" tabindex="-1"></a><span class="co"># modify names </span></span>
<span id="cb77-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-7" tabindex="-1"></a><span class="fu">names</span>(ExpectedCounts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>,<span class="st">&quot;Time_w_alone&quot;</span>,<span class="st">&quot;site_name&quot;</span>,<span class="st">&quot;site_id&quot;</span>,</span>
<span id="cb77-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-8" tabindex="-1"></a>                          <span class="st">&quot;visit_number&quot;</span>,<span class="st">&quot;common_name&quot;</span>,<span class="st">&quot;time_window&quot;</span>,</span>
<span id="cb77-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-9" tabindex="-1"></a>                          <span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb77-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-10" tabindex="-1"></a>                          <span class="st">&quot;acous_detections&quot;</span>,<span class="st">&quot;DateTime&quot;</span>,<span class="st">&quot;Time_window&quot;</span>, <span class="st">&quot;year&quot;</span>,</span>
<span id="cb77-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-11" tabindex="-1"></a>                          <span class="st">&quot;time_id&quot;</span>,<span class="st">&quot;Lower&quot;</span>, <span class="st">&quot;Estimated&quot;</span>, <span class="st">&quot;Upper&quot;</span>)</span>
<span id="cb77-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-12" tabindex="-1"></a></span>
<span id="cb77-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-13" tabindex="-1"></a></span>
<span id="cb77-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-14" tabindex="-1"></a>ExpectedCounts <span class="sc">|&gt;</span></span>
<span id="cb77-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-15" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Lower, Estimated, Upper, Observed),</span>
<span id="cb77-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-16" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Abundance&quot;</span>,</span>
<span id="cb77-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-17" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DateTime, </span>
<span id="cb77-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-19" tabindex="-1"></a>             <span class="at">y =</span> Count, </span>
<span id="cb77-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-20" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">factor</span>(Abundance,</span>
<span id="cb77-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-21" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb77-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-22" tabindex="-1"></a>                                       <span class="st">&quot;Upper&quot;</span>,</span>
<span id="cb77-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-23" tabindex="-1"></a>                                       <span class="st">&quot;Estimated&quot;</span>,</span>
<span id="cb77-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-24" tabindex="-1"></a>                                       <span class="st">&quot;Lower&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb77-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-25" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> <span class="fu">factor</span>(Abundance,</span>
<span id="cb77-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-26" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb77-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-27" tabindex="-1"></a>                                       <span class="st">&quot;Upper&quot;</span>,</span>
<span id="cb77-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-28" tabindex="-1"></a>                                       <span class="st">&quot;Estimated&quot;</span>,</span>
<span id="cb77-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-29" tabindex="-1"></a>                                       <span class="st">&quot;Lower&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb77-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-30" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(Abundance,</span>
<span id="cb77-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-31" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb77-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-32" tabindex="-1"></a>                                       <span class="st">&quot;Upper&quot;</span>,</span>
<span id="cb77-33"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-33" tabindex="-1"></a>                                       <span class="st">&quot;Estimated&quot;</span>,</span>
<span id="cb77-34"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-34" tabindex="-1"></a>                                       <span class="st">&quot;Lower&quot;</span>)))) <span class="sc">+</span></span>
<span id="cb77-35"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-35" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb77-36"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-36" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;OVEN - Katahdin Woods and Waters - 2023 sampling&quot;</span>,</span>
<span id="cb77-37"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-37" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Time (sampling window)&quot;</span>,</span>
<span id="cb77-38"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-38" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Counts&quot;</span>,</span>
<span id="cb77-39"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-39" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">&quot;Counts&quot;</span>,</span>
<span id="cb77-40"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-40" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="st">&quot;Counts&quot;</span>,</span>
<span id="cb77-41"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-41" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">&quot;Counts&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-42"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-42" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="st">&quot;dashed&quot;</span>,<span class="st">&quot;solid&quot;</span>,<span class="st">&quot;dashed&quot;</span>))<span class="sc">+</span></span>
<span id="cb77-43"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-43" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb77-44"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-44" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;darkgray&quot;</span>,<span class="st">&quot;black&quot;</span>,<span class="st">&quot;darkgray&quot;</span>)) <span class="sc">+</span></span>
<span id="cb77-45"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-45" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb77-46"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb77-46" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
</div>
<div id="coding-acoustic-detections-counts-1" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Coding Acoustic detections counts<a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#coding-acoustic-detections-counts-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-1" tabindex="-1"></a>StochGSS.acou.dc <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb78-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-2" tabindex="-1"></a>  </span>
<span id="cb78-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-3" tabindex="-1"></a>  <span class="co"># Priors on model parameters. Priors are DC1 in Lele et al (2007)</span></span>
<span id="cb78-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-4" tabindex="-1"></a>  a1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>);        <span class="co"># constant, equivalent to the population growth rate. </span></span>
<span id="cb78-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-5" tabindex="-1"></a>  c1 <span class="sc">~</span> <span class="fu">dunif</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>);       <span class="co"># constant, the density dependence parameter. </span></span>
<span id="cb78-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-6" tabindex="-1"></a>  sig1 <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="dv">10</span>); <span class="co">#variance parameter of stochastic  environment (process noise) in the system</span></span>
<span id="cb78-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-7" tabindex="-1"></a>  stovar1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">pow</span>(sig1,<span class="dv">2</span>)</span>
<span id="cb78-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-8" tabindex="-1"></a>  </span>
<span id="cb78-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-9" tabindex="-1"></a>   <span class="co"># Priors for observation model</span></span>
<span id="cb78-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-10" tabindex="-1"></a>  alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.001</span>)  <span class="co"># intercept for scaling</span></span>
<span id="cb78-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-11" tabindex="-1"></a>  gamma <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.001</span>)  <span class="co"># slope linking latent state X_t to mean</span></span>
<span id="cb78-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-12" tabindex="-1"></a>  r <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">50</span>)   <span class="co"># dispersion parameter for NegBin</span></span>
<span id="cb78-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-13" tabindex="-1"></a>  </span>
<span id="cb78-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-14" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb78-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-15" tabindex="-1"></a>    <span class="co"># Simulate trajectory that depends on the previous</span></span>
<span id="cb78-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-16" tabindex="-1"></a>    mean_X1[<span class="dv">1</span>,k] <span class="ot">&lt;-</span> a1<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>c1) <span class="co"># Expected value of the first realization of the process</span></span>
<span id="cb78-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-17" tabindex="-1"></a>    <span class="co"># this is drawn from the stationary distribution of the process</span></span>
<span id="cb78-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-18" tabindex="-1"></a>    <span class="co"># Equation 14 (main text) and  A.4 in Appendix of Dennis et al 2006</span></span>
<span id="cb78-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-19" tabindex="-1"></a>    Varno1[k] <span class="ot">&lt;-</span> <span class="fu">pow</span>(sig1,<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pow</span>(c1,<span class="dv">2</span>)) <span class="co">#. Equation A.5 in Appendix of Dennis et al 2006</span></span>
<span id="cb78-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-20" tabindex="-1"></a>    </span>
<span id="cb78-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-21" tabindex="-1"></a>    <span class="co"># Updating the state: Stochastic process for all time steps</span></span>
<span id="cb78-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-22" tabindex="-1"></a>    X1[<span class="dv">1</span>,k]<span class="sc">~</span><span class="fu">dnorm</span>(mean_X1[<span class="dv">1</span>,k], <span class="dv">1</span><span class="sc">/</span>Varno1[k]); <span class="co">#first estimation of population</span></span>
<span id="cb78-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-23" tabindex="-1"></a>    </span>
<span id="cb78-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-24" tabindex="-1"></a>    <span class="co">#iteration of the GSS model in the data</span></span>
<span id="cb78-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-25" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>qp1) {</span>
<span id="cb78-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-26" tabindex="-1"></a>      mean_X1[t,k] <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1 <span class="sc">*</span> X1[(t <span class="sc">-</span> <span class="dv">1</span>),k]</span>
<span id="cb78-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-27" tabindex="-1"></a>      X1[t,k] <span class="sc">~</span> <span class="fu">dnorm</span>(mean_X1[t,k], stovar1) <span class="co"># Et is included here since a+cX(t-1) + Et ~ Normal(a+cX(t-1),sigma^2)</span></span>
<span id="cb78-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-28" tabindex="-1"></a>    }</span>
<span id="cb78-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-29" tabindex="-1"></a>    </span>
<span id="cb78-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-30" tabindex="-1"></a>    <span class="co"># Updating the observations, from the acoustic detections under Negative Binomial observation error</span></span>
<span id="cb78-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-31" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>qp1) {</span>
<span id="cb78-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-32" tabindex="-1"></a>      Y1[t,k] <span class="sc">~</span> <span class="fu">dnegbin</span>(p[t,k], r)</span>
<span id="cb78-33"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-33" tabindex="-1"></a>      p[t,k] <span class="ot">&lt;-</span> r<span class="sc">/</span>(r<span class="sc">+</span>lambda[t,k])</span>
<span id="cb78-34"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-34" tabindex="-1"></a>      <span class="fu">log</span>(lambda[t,k]) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> gamma <span class="sc">*</span> X1[t,k]</span>
<span id="cb78-35"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-35" tabindex="-1"></a>      }</span>
<span id="cb78-36"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-36" tabindex="-1"></a>  }</span>
<span id="cb78-37"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb78-37" tabindex="-1"></a>}</span></code></pre></div>
<p>For this model, we will need some initial values of the parameters, and given that there could be many <code>NA</code> a wrap to provide those initial guess values.</p>
<p>And we have to bundle the data for Data cloning. Let’s fit the first species in the taxa with higher data (Ovenbird in Marsh-Billings-Rockefeller NHP) as a test.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-1" tabindex="-1"></a>ts<span class="fl">.4</span>guess  <span class="ot">&lt;-</span>  <span class="fu">as.numeric</span>(final_df<span class="sc">$</span>acous_detections)</span>
<span id="cb79-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-2" tabindex="-1"></a>tvec4guess  <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ts<span class="fl">.4</span>guess)</span>
<span id="cb79-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-3" tabindex="-1"></a>onets4guess <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tvec4guess, ts<span class="fl">.4</span>guess)</span>
<span id="cb79-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-4" tabindex="-1"></a>naive.guess <span class="ot">&lt;-</span> <span class="fu">guess.calc2.0</span>(<span class="at">TimeAndNs =</span> onets4guess)</span>
<span id="cb79-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-5" tabindex="-1"></a></span>
<span id="cb79-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-6" tabindex="-1"></a>datalistGSS.acou.dc <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">K =</span> <span class="dv">1</span>,</span>
<span id="cb79-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-7" tabindex="-1"></a>                       <span class="at">qp1 =</span> <span class="fu">length</span>(ts<span class="fl">.4</span>guess),</span>
<span id="cb79-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-8" tabindex="-1"></a>                       <span class="at">Y1 =</span> <span class="fu">dcdim</span>(<span class="fu">array</span>(ts<span class="fl">.4</span>guess,</span>
<span id="cb79-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-9" tabindex="-1"></a>                                        <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(ts<span class="fl">.4</span>guess),<span class="dv">1</span>)))) </span>
<span id="cb79-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-10" tabindex="-1"></a></span>
<span id="cb79-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-11" tabindex="-1"></a>dcrun.GSS.acou <span class="ot">&lt;-</span> <span class="fu">dc.fit</span>(<span class="at">data =</span> datalistGSS.acou.dc,</span>
<span id="cb79-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-12" tabindex="-1"></a>                    <span class="at">params =</span> <span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;c1&quot;</span>, <span class="st">&quot;sig1&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;r&quot;</span>), </span>
<span id="cb79-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-13" tabindex="-1"></a>                    <span class="at">model =</span> StochGSS.acou.dc, </span>
<span id="cb79-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-14" tabindex="-1"></a>                    <span class="at">n.clones =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb79-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-15" tabindex="-1"></a>                    <span class="at">multiply =</span> <span class="st">&quot;K&quot;</span>,</span>
<span id="cb79-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-16" tabindex="-1"></a>                    <span class="at">unchanged =</span> <span class="st">&quot;qp1&quot;</span>,</span>
<span id="cb79-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-17" tabindex="-1"></a>                    <span class="at">n.chains =</span> <span class="dv">3</span>,</span>
<span id="cb79-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-18" tabindex="-1"></a>                    <span class="at">n.adapt =</span> <span class="dv">5000</span>,</span>
<span id="cb79-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-19" tabindex="-1"></a>                    <span class="at">n.update =</span> <span class="dv">100</span>,</span>
<span id="cb79-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-20" tabindex="-1"></a>                    <span class="at">thin =</span> <span class="dv">20</span>,</span>
<span id="cb79-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-21" tabindex="-1"></a>                    <span class="at">n.iter =</span> <span class="dv">20000</span>)</span>
<span id="cb79-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-22" tabindex="-1"></a></span>
<span id="cb79-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb79-23" tabindex="-1"></a><span class="fu">saveRDS</span>(dcrun.GSS.acou, <span class="st">&quot;data/dcfitGSS_AcDet_2023_OVEN_KWW.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-1" tabindex="-1"></a>dcrun.GSS.acou <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/dcfitGSS_AcDet_2023_OVEN_KWW.rds&quot;</span>)</span>
<span id="cb80-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-2" tabindex="-1"></a></span>
<span id="cb80-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-3" tabindex="-1"></a><span class="fu">summary</span>(dcrun.GSS.acou);</span>
<span id="cb80-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-4" tabindex="-1"></a><span class="fu">dcdiag</span>(dcrun.GSS.acou) </span>
<span id="cb80-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dcdiag</span>(dcrun.GSS.acou))</span>
<span id="cb80-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-6" tabindex="-1"></a><span class="fu">pairs</span>(dcrun.GSS.acou)</span>
<span id="cb80-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb80-7" tabindex="-1"></a><span class="fu">coef</span>(dcrun.GSS.acou)</span></code></pre></div>
<div class="float">
<img src="figs/dc_GSS_parsAcouDet_OVEN2023KWW.jpeg" alt="Data cloning results for six parameters of GSS from acoustic detections" />
<div class="figcaption">Data cloning results for six parameters of GSS from acoustic detections</div>
</div>
<p>Although diagnostics for lambda.max decreases with more clones, the chains are not converging. It seems that this needs more iterations and change initial values.</p>
<p>Anyway, with these coefficients of the model, we can estimate latent count trajectories with the Kalman filter structure. This Kalman filter structure allows simultaneous estimation of latent states for observed time steps and prediction for missing ones, leveraging the temporal correlation in the process model.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-1" tabindex="-1"></a>Kalman.pred.acou.fn <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb81-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-2" tabindex="-1"></a><span class="co"># Priors on model parameters: they are on the real line.</span></span>
<span id="cb81-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-3" tabindex="-1"></a>  parms <span class="sc">~</span> <span class="fu">dmnorm</span>(MuPost,PrecPost)</span>
<span id="cb81-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-4" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> parms[<span class="dv">1</span>]   </span>
<span id="cb81-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-5" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]   <span class="co"># intercept for scaling</span></span>
<span id="cb81-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-6" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> parms[<span class="dv">3</span>] </span>
<span id="cb81-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-7" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> parms[<span class="dv">4</span>]  <span class="co"># slope linking latent state X_t to mean</span></span>
<span id="cb81-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-8" tabindex="-1"></a>  r <span class="ot">&lt;-</span> parms[<span class="dv">5</span>]      <span class="co"># overdispersion parameter for NegBinom</span></span>
<span id="cb81-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-9" tabindex="-1"></a>  sig1 <span class="ot">&lt;-</span> parms[<span class="dv">6</span>]</span>
<span id="cb81-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-10" tabindex="-1"></a>  stovar1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">pow</span>(sig1,<span class="dv">2</span>)</span>
<span id="cb81-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-11" tabindex="-1"></a></span>
<span id="cb81-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-12" tabindex="-1"></a>  <span class="co"># Likelihood</span></span>
<span id="cb81-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-13" tabindex="-1"></a>  mean_X1[<span class="dv">1</span>] <span class="ot">&lt;-</span> a1<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>c1) <span class="co"># Expected value of the first realization of the process</span></span>
<span id="cb81-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-14" tabindex="-1"></a>    <span class="co"># this is drawn from the stationary distribution of the process</span></span>
<span id="cb81-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-15" tabindex="-1"></a>    <span class="co"># Equation 14 (main text) and  A.4 in Appendix of Dennis et al 2006</span></span>
<span id="cb81-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-16" tabindex="-1"></a>    Varno1 <span class="ot">&lt;-</span> <span class="fu">pow</span>(sig1,<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pow</span>(c1,<span class="dv">2</span>)) <span class="co">#. Equation A.5 in Appendix of Dennis et al 2006</span></span>
<span id="cb81-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-17" tabindex="-1"></a>    </span>
<span id="cb81-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-18" tabindex="-1"></a>    <span class="co"># Updating the state: Stochastic process for all time steps</span></span>
<span id="cb81-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-19" tabindex="-1"></a>    X1[<span class="dv">1</span>]<span class="sc">~</span><span class="fu">dnorm</span>(mean_X1[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span>Varno1); <span class="co">#first estimation of population</span></span>
<span id="cb81-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-20" tabindex="-1"></a>    <span class="fu">log</span>(lambda[<span class="dv">1</span>]) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> gamma <span class="sc">*</span> X1[<span class="dv">1</span>]</span>
<span id="cb81-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-21" tabindex="-1"></a>    C[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">log</span>(lambda[<span class="dv">1</span>])</span>
<span id="cb81-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-22" tabindex="-1"></a>    <span class="co">#iteration of the GSS model in the data</span></span>
<span id="cb81-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-23" tabindex="-1"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>qp1) {</span>
<span id="cb81-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-24" tabindex="-1"></a>      mean_X1[t] <span class="ot">&lt;-</span> a1 <span class="sc">+</span> c1 <span class="sc">*</span> X1[(t <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb81-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-25" tabindex="-1"></a>      X1[t] <span class="sc">~</span> <span class="fu">dnorm</span>(mean_X1[t], stovar1) <span class="co"># Et is included here since a+cX(t-1) + Et ~ Normal(a+cX(t-1),sigma^2)</span></span>
<span id="cb81-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-26" tabindex="-1"></a>      </span>
<span id="cb81-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-27" tabindex="-1"></a>      Y1[(t<span class="dv">-1</span>)] <span class="sc">~</span> <span class="fu">dnegbin</span>(p[t], r)</span>
<span id="cb81-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-28" tabindex="-1"></a>      p[t] <span class="ot">&lt;-</span> r<span class="sc">/</span>(r<span class="sc">+</span>lambda[t])</span>
<span id="cb81-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-29" tabindex="-1"></a>      <span class="fu">log</span>(lambda[t]) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> gamma <span class="sc">*</span> X1[t]</span>
<span id="cb81-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-30" tabindex="-1"></a>      C[t] <span class="ot">&lt;-</span> <span class="fu">log</span>(lambda[t]) <span class="co"># expected count</span></span>
<span id="cb81-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-31" tabindex="-1"></a>    }</span>
<span id="cb81-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb81-32" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb82-1" tabindex="-1"></a>data4kalmanAco <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">qp1 =</span> <span class="fu">as.numeric</span>(<span class="fu">length</span>(final_df<span class="sc">$</span>acous_detections)),</span>
<span id="cb82-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb82-2" tabindex="-1"></a>                    <span class="at">Y1 =</span> <span class="fu">array</span>(final_df<span class="sc">$</span>acous_detections,</span>
<span id="cb82-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb82-3" tabindex="-1"></a>                               <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">as.numeric</span>(<span class="fu">length</span>(final_df<span class="sc">$</span>acous_detections)))),</span>
<span id="cb82-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb82-4" tabindex="-1"></a>                    <span class="at">MuPost =</span> <span class="fu">coef</span>(dcrun.GSS.acou),</span>
<span id="cb82-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb82-5" tabindex="-1"></a>                    <span class="at">PrecPost =</span> <span class="fu">solve</span>(<span class="fu">vcov</span>(dcrun.GSS.acou))) </span></code></pre></div>
<p>And run the Bayesian inference using the MLE from Data cloning</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb83-1" tabindex="-1"></a>BH_DC_Pred_Acou <span class="ot">=</span> <span class="fu">jags.fit</span>(<span class="at">data=</span>data4kalmanAco, </span>
<span id="cb83-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb83-2" tabindex="-1"></a>                      <span class="at">params=</span><span class="fu">c</span>(<span class="st">&quot;C&quot;</span>), </span>
<span id="cb83-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb83-3" tabindex="-1"></a>                      <span class="at">model=</span>Kalman.pred.acou.fn)</span></code></pre></div>
<p>And we can generate a dataframe of the time series with the estimates, inter quartile range, and observed data through time</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-1" tabindex="-1"></a><span class="fu">summary</span>(BH_DC_Pred_Acou)</span>
<span id="cb84-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-2" tabindex="-1"></a><span class="co"># extract predictions and CI around them</span></span>
<span id="cb84-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-3" tabindex="-1"></a>predAcou <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">mcmcapply</span>(BH_DC_Pred_Acou, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))))</span>
<span id="cb84-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-4" tabindex="-1"></a></span>
<span id="cb84-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-5" tabindex="-1"></a></span>
<span id="cb84-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-6" tabindex="-1"></a>ExpectedCountsAcou <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(ExpectedCounts,predAcou))</span>
<span id="cb84-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-7" tabindex="-1"></a><span class="co"># modify names </span></span>
<span id="cb84-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-8" tabindex="-1"></a><span class="fu">names</span>(ExpectedCountsAcou) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>,<span class="st">&quot;Time_w_alone&quot;</span>,<span class="st">&quot;site_name&quot;</span>,<span class="st">&quot;site_id&quot;</span>,</span>
<span id="cb84-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-9" tabindex="-1"></a>                          <span class="st">&quot;visit_number&quot;</span>,<span class="st">&quot;common_name&quot;</span>,<span class="st">&quot;time_window&quot;</span>,</span>
<span id="cb84-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-10" tabindex="-1"></a>                          <span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb84-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-11" tabindex="-1"></a>                          <span class="st">&quot;AcousticDetections&quot;</span>,</span>
<span id="cb84-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-12" tabindex="-1"></a>                          <span class="st">&quot;DateTime&quot;</span>,<span class="st">&quot;Time_window&quot;</span>, <span class="st">&quot;year&quot;</span>,</span>
<span id="cb84-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-13" tabindex="-1"></a>                          <span class="st">&quot;time_id&quot;</span>,</span>
<span id="cb84-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-14" tabindex="-1"></a>                          <span class="st">&quot;CountLower&quot;</span>, <span class="st">&quot;CountEstimated&quot;</span>, <span class="st">&quot;CountUpper&quot;</span>,</span>
<span id="cb84-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-15" tabindex="-1"></a>                          <span class="st">&quot;AcouDetLower&quot;</span>, <span class="st">&quot;AcouDetEstimated&quot;</span>, <span class="st">&quot;AcouDetUpper&quot;</span>)</span>
<span id="cb84-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-16" tabindex="-1"></a></span>
<span id="cb84-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-17" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">2</span>))  <span class="co"># low, left, up, right</span></span>
<span id="cb84-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-18" tabindex="-1"></a></span>
<span id="cb84-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-19" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-20" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>Observed, </span>
<span id="cb84-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-21" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#1b7837&quot;</span>, </span>
<span id="cb84-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-22" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>), </span>
<span id="cb84-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-23" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Counts&quot;</span>,</span>
<span id="cb84-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-24" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time (sampling window)&quot;</span>)</span>
<span id="cb84-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-25" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-26" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcousticDetections, </span>
<span id="cb84-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-27" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#762a83&quot;</span>)</span>
<span id="cb84-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-28" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-29" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountEstimated, </span>
<span id="cb84-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-30" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#7fbf7b&quot;</span>)</span>
<span id="cb84-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-31" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-32" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountLower, </span>
<span id="cb84-33"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-33" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#d9f0d3&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb84-34"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-34" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-35"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-35" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountUpper, </span>
<span id="cb84-36"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-36" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#d9f0d3&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb84-37"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-37" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-38"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-38" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetEstimated, </span>
<span id="cb84-39"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-39" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#af8dc3&quot;</span>)</span>
<span id="cb84-40"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-40" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-41"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-41" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetLower, </span>
<span id="cb84-42"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-42" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#e7d4e8&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb84-43"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-43" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb84-44"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-44" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetUpper, </span>
<span id="cb84-45"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-45" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#e7d4e8&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb84-46"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-46" tabindex="-1"></a></span>
<span id="cb84-47"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-47" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="fu">min</span>(ExpectedCountsAcou<span class="sc">$</span>DateTime),</span>
<span id="cb84-48"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-48" tabindex="-1"></a>       <span class="at">y =</span> <span class="dv">65</span>,</span>
<span id="cb84-49"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-49" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.7</span>, </span>
<span id="cb84-50"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-50" tabindex="-1"></a>       <span class="at">pt.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb84-51"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-51" tabindex="-1"></a>       <span class="at">xpd =</span> <span class="cn">TRUE</span>,</span>
<span id="cb84-52"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-52" tabindex="-1"></a>       <span class="at">horiz =</span> <span class="cn">FALSE</span>,</span>
<span id="cb84-53"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-53" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Observed from point counts&quot;</span>, </span>
<span id="cb84-54"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-54" tabindex="-1"></a>                  <span class="st">&quot;Acoustic detections&quot;</span>, </span>
<span id="cb84-55"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-55" tabindex="-1"></a>                  <span class="st">&quot;Estimate from point counts&quot;</span>, </span>
<span id="cb84-56"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-56" tabindex="-1"></a>                  <span class="st">&quot;Point count CI estimates&quot;</span>, </span>
<span id="cb84-57"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-57" tabindex="-1"></a>                  <span class="st">&quot;Estimate from acoustic detections&quot;</span>, </span>
<span id="cb84-58"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-58" tabindex="-1"></a>                  <span class="st">&quot;Acoustic detections CI estimates&quot;</span>),</span>
<span id="cb84-59"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-59" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#1b7837&quot;</span>, </span>
<span id="cb84-60"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-60" tabindex="-1"></a>               <span class="st">&quot;#762a83&quot;</span>, </span>
<span id="cb84-61"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-61" tabindex="-1"></a>               <span class="st">&quot;#7fbf7b&quot;</span>, </span>
<span id="cb84-62"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-62" tabindex="-1"></a>               <span class="st">&quot;#d9f0d3&quot;</span>, </span>
<span id="cb84-63"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-63" tabindex="-1"></a>               <span class="st">&quot;#af8dc3&quot;</span>, </span>
<span id="cb84-64"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-64" tabindex="-1"></a>               <span class="st">&quot;#e7d4e8&quot;</span>),</span>
<span id="cb84-65"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-65" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>),   <span class="co"># NA for points, 1 for solid lines, 2 for dashed</span></span>
<span id="cb84-66"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-66" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="co"># symbols for points</span></span>
<span id="cb84-67"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb84-67" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)                     <span class="co"># no box around legend</span></span></code></pre></div>
<div class="float">
<img src="figs/ExpecCountsOVEN_KWW_2023_A.jpeg" alt="Observed and estimated counts from point counts and acoustic detections - A" />
<div class="figcaption">Observed and estimated counts from point counts and acoustic detections - A</div>
</div>
<p>Cutting the edges to see the details of the estimates:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>))  </span>
<span id="cb85-2"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-2" tabindex="-1"></a></span>
<span id="cb85-3"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-4"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-4" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>Observed, </span>
<span id="cb85-5"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-5" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#1b7837&quot;</span>, </span>
<span id="cb85-6"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-6" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), </span>
<span id="cb85-7"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Counts&quot;</span>,</span>
<span id="cb85-8"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-8" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time (sampling window)&quot;</span>, </span>
<span id="cb85-9"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-9" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;OVEN - 2023 - Katahdin Woods and Waters&quot;</span>)</span>
<span id="cb85-10"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-10" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-11"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-11" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcousticDetections, </span>
<span id="cb85-12"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-12" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#762a83&quot;</span>)</span>
<span id="cb85-13"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-13" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-14"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-14" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountEstimated, </span>
<span id="cb85-15"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-15" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#7fbf7b&quot;</span>)</span>
<span id="cb85-16"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-16" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-17"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-17" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountLower, </span>
<span id="cb85-18"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-18" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#d9f0d3&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb85-19"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-19" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-20"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-20" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>CountUpper, </span>
<span id="cb85-21"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-21" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#d9f0d3&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb85-22"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-22" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-23"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-23" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetEstimated, </span>
<span id="cb85-24"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-24" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#af8dc3&quot;</span>)</span>
<span id="cb85-25"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-25" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-26"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-26" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetLower, </span>
<span id="cb85-27"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-27" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#e7d4e8&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb85-28"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-28" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> ExpectedCountsAcou<span class="sc">$</span>DateTime,</span>
<span id="cb85-29"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-29" tabindex="-1"></a>     <span class="at">y =</span> ExpectedCountsAcou<span class="sc">$</span>AcouDetUpper, </span>
<span id="cb85-30"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-30" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;#e7d4e8&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb85-31"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-31" tabindex="-1"></a></span>
<span id="cb85-32"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-32" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="fu">quantile</span>(ExpectedCountsAcou<span class="sc">$</span>DateTime, <span class="fl">0.75</span>),</span>
<span id="cb85-33"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-33" tabindex="-1"></a>       <span class="at">y =</span> <span class="dv">10</span>,</span>
<span id="cb85-34"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-34" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.7</span>, </span>
<span id="cb85-35"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-35" tabindex="-1"></a>       <span class="at">pt.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb85-36"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-36" tabindex="-1"></a>       <span class="at">xpd =</span> <span class="cn">TRUE</span>,</span>
<span id="cb85-37"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-37" tabindex="-1"></a>       <span class="at">horiz =</span> <span class="cn">FALSE</span>,</span>
<span id="cb85-38"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-38" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Observed from point counts&quot;</span>, </span>
<span id="cb85-39"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-39" tabindex="-1"></a>                  <span class="st">&quot;Acoustic detections&quot;</span>, </span>
<span id="cb85-40"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-40" tabindex="-1"></a>                  <span class="st">&quot;Estimate from point counts&quot;</span>, </span>
<span id="cb85-41"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-41" tabindex="-1"></a>                  <span class="st">&quot;Point count CI estimates&quot;</span>, </span>
<span id="cb85-42"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-42" tabindex="-1"></a>                  <span class="st">&quot;Estimate from acoustic detections&quot;</span>, </span>
<span id="cb85-43"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-43" tabindex="-1"></a>                  <span class="st">&quot;Acoustic detections CI estimates&quot;</span>),</span>
<span id="cb85-44"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-44" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#1b7837&quot;</span>, </span>
<span id="cb85-45"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-45" tabindex="-1"></a>               <span class="st">&quot;#762a83&quot;</span>, </span>
<span id="cb85-46"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-46" tabindex="-1"></a>               <span class="st">&quot;#7fbf7b&quot;</span>, </span>
<span id="cb85-47"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-47" tabindex="-1"></a>               <span class="st">&quot;#d9f0d3&quot;</span>, </span>
<span id="cb85-48"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-48" tabindex="-1"></a>               <span class="st">&quot;#af8dc3&quot;</span>, </span>
<span id="cb85-49"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-49" tabindex="-1"></a>               <span class="st">&quot;#e7d4e8&quot;</span>),</span>
<span id="cb85-50"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-50" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>),   <span class="co"># NA for points, 1 for solid lines, 2 for dashed</span></span>
<span id="cb85-51"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-51" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="co"># symbols for points</span></span>
<span id="cb85-52"><a href="another-example-with-hierarchical-model-approach---oven-in-katahdin-woods-and-waters.html#cb85-52" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)                     <span class="co"># no box around legend</span></span></code></pre></div>
<div class="float">
<img src="figs/ExpecCountsOVEN_KWW_2023_B.jpeg" alt="Observed and estimated counts from point counts and acoustic detections - B" />
<div class="figcaption">Observed and estimated counts from point counts and acoustic detections - B</div>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-model-approach.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/newHampshire-pointCount-acoustics/edit/master/Counts_AcousticDetections_oac_OVEN2023KWW.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
